% == PACKAGES USED == %

\RequirePackage{tikz}
\usetikzlibrary{calc}

\RequirePackage{nicematrix}
\RequirePackage{xstring}


% == DEFINITIONS == %

% Abstraction

%   #1 : & or && (no deco or deco)
%
%   #2 : 1st vector
%   #3 : 2nd vector

\newcommand\tns@det@plane@open@with@vect[3]{%
    \begin{vNiceMatrix}[first-row]
        {\scriptsize#2} #1 {\scriptsize#3} \\
}  


%   #1 : option
%   #2 : & or && (no deco or deco)
%
%   #3 : 1st vector
%   #4 : 2nd vector

\newcommand\tns@det@plane@open[4]{%
    \IfEqCase{#1}{
        {vec}{
            \tns@det@plane@open@with@vect{#2}{#3}{#4}
        }{novec}{
            \begin{vNiceMatrix}
        }%
    }[%
        \PackageError{tnscom}{unknown value for 1st argument}%
                             {you can use vec or novec.}%
	]
}        


% Entries
%
%   #1 : & or && (no deco or deco)
%
%   #2  #4        x  x'
%   #3  #5        y  y'

\newcommand\tns@det@plane@entries[5]{%
    #2 #1 #4 \\
    #3 #1 #5
}        


%   #1 : option for the formatting
%
%   #2  #5        u  v
%   
%   #3  #6        x  x'
%   #4  #7        y  y'

\newcommand\tns@det@plane@no@deco[7]{%
    \tns@det@plane@open{#1}{&}{#2}{#5}
        \tns@det@plane@entries{&}{#3}{#4}{#6}{#7}
    \end{vNiceMatrix}
}


\newcommand\tns@det@plane@deco[7]{%
    \tns@det@plane@open{#1}{&&}{#2}{#5}
        \tns@det@plane@entries{&&}{#3}{#4}{#6}{#7}
        %%
        \CodeAfter
        \begin{tikzpicture}
            \path (1-1.east) 
               -- node[below = 0.45em,
                       red,
                       circle,
                       inner sep = 1.25pt] 
                  (minus) {\tiny$-$}
                  (1-3.west);
            \draw [red,->]
                let \p1 = ($(minus.east) - (minus.center)$) in 
                    ([xshift = 0.5mm]1-1.east)
                    to[out = 0, in = 137.5]
                    (minus.50)
                    arc[start angle = 50,
                end angle = -230,
                radius = \x1] 
                    to[out = 42.5, in =190]
                    ([xshift = -0.3mm]1-1.east-|1-3.west);
        \end{tikzpicture}   
    \end{vNiceMatrix}
}


